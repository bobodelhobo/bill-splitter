<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bill Splitter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; background-color: #f9f9f9; }
    .section { margin-bottom: 20px; }
    input, select, button { padding: 10px; margin: 5px; font-size: 16px; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { font-weight: bold; text-decoration: underline; background-color: #d9e7f3; color: #000; }
    td { background-color: #f9f9f9; color: #000; }
    .bold { font-weight: bold; }

    @media only screen and (max-width: 768px) {
      body { padding: 15px; }
      input, select, button { width: 100%; font-size: 14px; }
      table { font-size: 14px; }
    }

    @media only screen and (max-width: 480px) {
      body { padding: 10px; }
      input, select, button { width: 100%; font-size: 12px; }
      table { font-size: 12px; }
    }
  </style>
</head>
<body>
  <h1>Bill Splitter</h1>

  <div class="section">
    <h3 class="bold">Person's Name</h3>
    <input type="text" id="personName" placeholder="Enter person's name">
    <button onclick="addPerson()">Add Person</button>
    <ul id="peopleList"></ul>
  </div>

  <div class="section">
    <h3 class="bold">Dishes</h3>
    <input type="text" id="dishDesc" placeholder="Description">
    <input type="number" id="dishAmount" placeholder="Amount">
    <select id="dishPerson"></select>
    <button onclick="addItem('dish')">Add Dish</button><br>
    <label><input type="checkbox" id="dishGST"> GST (9%)</label>
    <label><input type="checkbox" id="dishService"> Service Charge (10%)</label>
    <label><input type="checkbox" id="dishAdditionalToggle"> Additional</label>
    <input type="number" id="dishAdditional" placeholder="%" style="width:80px;">
  </div>

  <div class="section">
    <h3 class="bold">Miscellaneous</h3>
    <input type="text" id="miscDesc" placeholder="Description">
    <input type="number" id="miscAmount" placeholder="Amount">
    <select id="miscPerson"></select>
    <button onclick="addItem('misc')">Add Miscellaneous</button><br>
    <label><input type="checkbox" id="miscGST"> GST (9%)</label>
    <label><input type="checkbox" id="miscService"> Service Charge (10%)</label>
    <label><input type="checkbox" id="miscAdditionalToggle"> Additional</label>
    <input type="number" id="miscAdditional" placeholder="%" style="width:80px;">
  </div>

  <div class="section">
    <h2 class="bold">Bill Breakdown</h2>
    <div id="personBreakdowns"></div>
    <div id="totalsTable" style="display: none;">
      <table>
        <thead>
          <tr><th class="bold">Total Dishes</th><th class="bold">Total Miscellaneous</th><th class="bold">Grand Total Before Charges</th><th class="bold">Grand Total</th></tr>
        </thead>
        <tbody>
          <tr>
            <td id="totalDishes">$0.00</td>
            <td id="totalMiscellaneous">$0.00</td>
            <td id="grandTotalBefore">$0.00</td>
            <td id="grandTotalAfter">$0.00</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="section">
    <button onclick="downloadPDF()">Download PDF</button>
    <button onclick="resetPage()">Reset Page</button>
  </div>

<script>
  const people = JSON.parse(localStorage.getItem("people")) || [];
  let items = JSON.parse(localStorage.getItem("items")) || [];

  window.onload = () => {
    people.forEach(name => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${name}</strong> <button onclick="removePerson('${name}', this)">Remove</button>`;
      document.getElementById("peopleList").appendChild(li);
    });
    updateDropdowns();
    updateBill();
  };

  function saveToLocalStorage() {
    localStorage.setItem("people", JSON.stringify(people));
    localStorage.setItem("items", JSON.stringify(items));
  }

  function addPerson() {
    const name = document.getElementById("personName").value.trim();
    if (name && !people.includes(name)) {
      people.push(name);
      saveToLocalStorage();
      const li = document.createElement("li");
      li.innerHTML = `<strong>${name}</strong> <button onclick="removePerson('${name}', this)">Remove</button>`;
      document.getElementById("peopleList").appendChild(li);
      updateDropdowns();
      document.getElementById("personName").value = "";
    }
  }

  function removePerson(name, btn) {
    // Remove the person from the people list and their associated items
    people.splice(people.indexOf(name), 1);
    items = items.filter(item => item.person !== name);
    saveToLocalStorage();
    btn.parentElement.remove();
    updateDropdowns();
    updateBill();
  }

  function updateDropdowns() {
    const ids = ["dishPerson", "miscPerson"];
    ids.forEach(id => {
      const select = document.getElementById(id);
      select.innerHTML = people.map(p => `<option value="${p}">${p}</option>`).join("");
    });
  }

  function addItem(type) {
    const desc = document.getElementById(`${type}Desc`).value.trim();
    const amt = parseFloat(document.getElementById(`${type}Amount`).value);
    const person = document.getElementById(`${type}Person`).value;
    if (!desc || isNaN(amt) || !person) return;

    let finalAmount = amt;
    let gst = 0, serviceCharge = 0, additionalCharge = 0;

    if (document.getElementById(`${type}GST`).checked) {
      gst = amt * 0.09;
      finalAmount += gst;
    }
    if (document.getElementById(`${type}Service`).checked) {
      serviceCharge = amt * 0.10;
      finalAmount += serviceCharge;
    }
    if (document.getElementById(`${type}AdditionalToggle`).checked) {
      additionalCharge = parseFloat(document.getElementById(`${type}Additional`).value);
      if (!isNaN(additionalCharge)) finalAmount += amt * (additionalCharge / 100);
    }

    finalAmount = parseFloat(finalAmount.toFixed(2));
    items.push({ desc, amt, finalAmount, person, gst, serviceCharge, additionalCharge, type });
    saveToLocalStorage();

    document.getElementById(`${type}Desc`).value = "";
    document.getElementById(`${type}Amount`).value = "";

    updateBill();
  }

  function updateBill() {
    const breakdown = document.getElementById("personBreakdowns");
    breakdown.innerHTML = "";
    let totalDishes = 0, totalMisc = 0, grandBefore = 0, grandAfter = 0;

    const personTotals = {};

    people.forEach(p => {
      personTotals[p] = { dishes: [], misc: [], totalBefore: 0, totalAfter: 0 };
    });

    items.forEach(i => {
      const pt = personTotals[i.person];
      if (i.type === "dish") {
        pt.dishes.push(i);
        totalDishes += i.finalAmount;
      } else {
        pt.misc.push(i);
        totalMisc += i.finalAmount;
      }
      pt.totalBefore += i.amt;
      pt.totalAfter += i.finalAmount;
    });

    grandBefore = items.reduce((s, i) => s + i.amt, 0);
    grandAfter = items.reduce((s, i) => s + i.finalAmount, 0);

    document.getElementById("totalDishes").textContent = `$${totalDishes.toFixed(2)}`;
    document.getElementById("totalMiscellaneous").textContent = `$${totalMisc.toFixed(2)}`;
    document.getElementById("grandTotalBefore").textContent =
      `Grand Total Before Charges: $${grandBefore.toFixed(2)}`;
    document.getElementById("grandTotalAfter").textContent =
      `Grand Total After Charges: $${grandAfter.toFixed(2)}`;
    document.getElementById("totalsTable").style.display = "block";

    people.forEach(p => {
      const pt = personTotals[p];
      let html = `<h3>${p}'s Itemized Bill</h3><table><thead><tr><th>Description</th><th>Amount Before</th><th>Amount After</th></tr></thead><tbody>`;

      [...pt.dishes, ...pt.misc].forEach(i => {
        html += `<tr><td>${i.desc}</td><td>$${i.amt.toFixed(2)}</td><td>$${i.finalAmount.toFixed(2)}</td></tr>`;
      });

      html += `</tbody></table><br>`;
      breakdown.innerHTML += html;
    });
  }

  function resetPage() {
    localStorage.clear();
    location.reload();
  }

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFont("helvetica", "normal");
    doc.setFontSize(14);
    doc.setTextColor(255, 255, 255); // White text
    doc.setFillColor(0, 0, 0); // Black background

    doc.rect(0, 0, 210, 297, "F"); // Set background color

    let y = 10;
    doc.text("Bill Splitter Summary", 20, y);
    y += 10;

    people.forEach(p => {
      const personItems = items.filter(i => i.person === p);
      if (personItems.length === 0) return;

      doc.text(`${p}'s Itemized Bill`, 20, y);
      y += 5;

      const tableData = personItems.map(i => [
        i.desc,
        `$${i.amt.toFixed(2)}`,
        `$${i.finalAmount.toFixed(2)}`
      ]);

      doc.autoTable({
        head: [['Description', 'Amount Before', 'Amount After']],
        body: tableData,
        startY: y,
        theme: 'grid',
        headStyles: { fillColor: [0, 255, 255], textColor: [0, 0, 0], fontStyle: 'bold', textDecoration: 'underline' },
        styles: { cellPadding: 4, fillColor: [255, 255, 255] }
      });

      y = doc.lastAutoTable.finalY + 5;
    });

    const totalDishes = items.filter(i => i.type === "dish").reduce((s, i) => s + i.finalAmount, 0);
    const totalMisc = items.filter(i => i.type === "misc").reduce((s, i) => s + i.finalAmount, 0);
    const grandAfter = items.reduce((s, i) => s + i.finalAmount, 0);
    const grandBefore = items.reduce((s, i) => s + i.amt, 0);

    doc.autoTable({
      head: [['Total Dishes', 'Total Miscellaneous', 'Grand Total Before Charges', 'Grand Total After Charges']],
      body: [[
        `$${totalDishes.toFixed(2)}`,
        `$${totalMisc.toFixed(2)}`,
        `$${grandBefore.toFixed(2)}`,
        `$${grandAfter.toFixed(2)}`
      ]],
      startY: y,
      styles: { fontStyle: 'bold', cellPadding: 5, fillColor: [30, 30, 30] }
    });

    doc.save("Total Bill.pdf");
  }
</script>
</body>
</html>
